<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì €ì”¨ ìˆ˜ì—¼ ë½‘ê¸° ê²Œì„</title>
    <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f7f3e8;
            font-family: 'Jua', sans-serif;
            margin: 0;
            overflow: hidden;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
            background: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            position: relative;
        }

        h1 {
            color: #4a2c00;
            margin-bottom: 20px;
            font-size: 2.5rem;
        }

        .score-board {
            font-size: 1.5rem;
            color: #6a4c2c;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            padding: 10px;
            border: 2px dashed #a07d58;
            border-radius: 10px;
            background-color: #fffaf0;
        }

        .time-display {
            font-weight: bold;
            color: #cc0000;
        }

        /* --- ì•„ì €ì”¨ ìºë¦­í„° ìŠ¤íƒ€ì¼ --- */
        .ahjussi-head {
            position: relative;
            width: 300px;
            height: 350px;
            background-color: #fcd7b9;
            /* í”¼ë¶€ìƒ‰ */
            border-radius: 50%;
            border: 8px solid #4a2c00;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        /* ë¨¸ë¦¬ì¹´ë½ */
        .hair {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 250px;
            height: 80px;
            background-color: #2c2c2c;
            border-radius: 50% 50% 0 0;
            clip-path: polygon(0 100%, 10% 20%, 30% 0, 50% 20%, 70% 0, 90% 20%, 100% 100%);
        }

        /* ê·€ */
        .ear {
            position: absolute;
            width: 40px;
            height: 70px;
            background: #fcd7b9;
            border: 6px solid #4a2c00;
            border-radius: 50%;
            top: 150px;
            z-index: -1;
        }

        .ear.left {
            left: -30px;
        }

        .ear.right {
            right: -30px;
        }


        /* ëˆˆ (ê¸°ë³¸/ì¤‘ë¦½ í‘œì •) */
        .eye {
            position: absolute;
            width: 30px;
            height: 40px;
            background: white;
            border: 4px solid #4a2c00;
            border-radius: 50%;
            top: 100px;
            overflow: hidden;
            transition: all 0.1s ease-out;
        }

        .eye.left {
            left: 80px;
        }

        .eye.right {
            right: 80px;
        }

        .pupil {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #4a2c00;
            border-radius: 50%;
            top: 15px;
            left: 10px;
        }

        /* ì½” */
        .nose {
            position: absolute;
            width: 30px;
            height: 20px;
            background: #e6b89c;
            top: 160px;
            left: 50%;
            transform: translateX(-50%);
            border-radius: 50%;
            border: 2px solid #4a2c00;
            z-index: 10;
        }

        /* ì… (ê¸°ë³¸/ì¤‘ë¦½ í‘œì •) */
        .mouth {
            position: absolute;
            width: 80px;
            height: 15px;
            background: transparent;
            border: 4px solid #4a2c00;
            border-radius: 0 0 40px 40px;
            border-top: none;
            top: 230px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            transition: all 0.1s ease-out;
        }

        /* ìˆ˜ì—¼ (í´ë¦­ ê°€ëŠ¥í•œ ìš”ì†Œ) */
        .beard-hair {
            position: absolute;
            width: 3px;
            height: 20px;
            background-color: #4a2c00;
            border-radius: 2px;
            cursor: pointer;
            transition: opacity 0.1s;
            transform-origin: bottom center;
            box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
            z-index: 20;
        }

        .beard-hair:hover {
            opacity: 0.7;
            transform: scale(1.1) rotate(0deg);
        }

        /* --- ê³ í†µìŠ¤ëŸ¬ìš´ í‘œì • (Pain Expression) ìŠ¤íƒ€ì¼ --- */
        .pain .eye {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 4px solid #cc0000;
            /* ëˆˆ í…Œë‘ë¦¬ ë¹¨ê°„ìƒ‰ */
            top: 105px;
            transition: all 0.1s ease-in;
        }

        .pain .pupil {
            display: none;
            /* ë™ê³µ ìˆ¨ê¸°ê¸° */
        }

        /* ëˆˆì¹ ì°¡ê·¸ë¦¼ */
        .pain::before {
            content: '';
            position: absolute;
            width: 10px;
            height: 30px;
            background: #4a2c00;
            border-radius: 50%;
            top: 90px;
            left: 90px;
            transform: rotate(-45deg);
        }

        .pain::after {
            content: '';
            position: absolute;
            width: 10px;
            height: 30px;
            background: #4a2c00;
            border-radius: 50%;
            top: 90px;
            right: 90px;
            transform: rotate(45deg);
        }

        .pain .mouth {
            width: 100px;
            height: 30px;
            border: 4px solid #cc0000;
            border-radius: 50%;
            background: #ff5555;
            /* ì… ì•ˆìª½ ë¹¨ê°›ê²Œ */
            top: 220px;
            transition: all 0.1s ease-in;
        }

        /* ë”°ë” íš¨ê³¼ í…ìŠ¤íŠ¸ */
        .ouch-text {
            position: absolute;
            top: 180px;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            color: #cc0000;
            font-weight: bold;
            text-shadow: 2px 2px 5px rgba(255, 255, 255, 0.8);
            opacity: 0;
            transition: all 0.2s ease-out;
            pointer-events: none;
            z-index: 100;
        }

        .ouch-text.show {
            opacity: 1;
            transform: translate(-50%, -100%) scale(1.2);
        }

        .button-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .restart-button {
            padding: 10px 20px;
            font-size: 1.2rem;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px #0056b3;
            transition: background-color 0.2s, box-shadow 0.2s, transform 0.2s;
        }

        .restart-button:hover {
            background-color: #0056b3;
        }

        .restart-button:active {
            transform: translateY(4px);
            box-shadow: 0 0 #0056b3;
        }

        #close-button {
            background-color: #dc3545; /* Red color */
            box-shadow: 0 4px #c82333;
        }

        #close-button:hover {
            background-color: #c82333;
        }

        #close-button:active {
            transform: translateY(4px);
            box-shadow: 0 0 #c82333;
        }

        /* --- ìºë¦­í„° ì™¸í˜• ë³€í˜• ìŠ¤íƒ€ì¼ --- */

        /* ìŠ¤íƒ€ì¼ 1: ê°ˆìƒ‰ ë¨¸ë¦¬, ë°ì€ í”¼ë¶€ */
        .style-1 .hair {
            background-color: #8B4513; /* SaddleBrown */
        }
        .style-1.ahjussi-head {
            background-color: #FFDEAD; /* NavajoWhite */
        }
        .style-1 .ear {
            background-color: #FFDEAD;
        }
        .style-1 .pupil {
            background-color: #4682B4; /* SteelBlue */
        }

        /* ìŠ¤íƒ€ì¼ 2: ê¸ˆë°œ ë¨¸ë¦¬, ì•ˆê²½ */
        .style-2 .hair {
            background-color: #FFD700; /* Gold */
        }
        /* ì•ˆê²½ */
        .style-2 .eye::before {
            content: '';
            position: absolute;
            width: 50px;
            height: 50px;
            border: 5px solid #333;
            border-radius: 50%;
            top: -10px;
            left: -15px;
            z-index: 50;
        }
        /* ì•ˆê²½ ì—°ê²°ë¶€ */
        .style-2 .eye.left::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 4px;
            background: #333;
            top: 15px;
            right: -55px;
        }
    </style>
</head>

<body>

    <div class="game-container">
        <h1>ìˆ˜ì—¼ ë½‘ê¸° ì•„ì €ì”¨!</h1>
        <div class="score-board">
            <!-- ë‚¨ì€ ì‹œê°„ í‘œì‹œ ì¶”ê°€ -->
            ë‚¨ì€ ì‹œê°„: <span id="time-display" class="time-display">0</span>ì´ˆ |
            ë½‘ì€ ìˆ˜ì—¼: <span id="pluck-count">0</span> / <span id="total-count">0</span>
        </div>

        <div id="ahjussi-head" class="ahjussi-head">
            <div class="hair"></div>
            <div class="ear left"></div>
            <div class="ear right"></div>

            <div class="eye left">
                <div class="pupil"></div>
            </div>
            <div class="eye right">
                <div class="pupil"></div>
            </div>

            <div class="nose"></div>

            <div class="mouth"></div>

            <div id="ouch-text" class="ouch-text">ë”°ë”!</div>
        </div>

        <div class="button-container">
            <button id="restart-button" class="restart-button" onclick="restartGame()">ê²Œì„ ì¬ì‹œì‘</button>
            <button id="close-button" class="restart-button">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        const ahjussiHead = document.getElementById('ahjussi-head');
        const pluckCountElement = document.getElementById('pluck-count');
        const totalCountElement = document.getElementById('total-count');
        const ouchText = document.getElementById('ouch-text');
        const timeDisplayElement = document.getElementById('time-display'); // ìƒˆ ìš”ì†Œ

        // Web Audio API ì´ˆê¸°í™”
        let audioCtx;
        try {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        } catch (e) {
            console.error('Web Audio API is not supported in this browser');
        }

        /**
         * 'ì•…!' ì†Œë¦¬ë¥¼ ì¬ìƒí•©ë‹ˆë‹¤.
         */
        function playOuchSound() {
            if (!audioCtx) return;

            // ì‚¬ìš©ìê°€ í˜ì´ì§€ì™€ ìƒí˜¸ ì‘ìš©í•  ë•Œê¹Œì§€ AudioContextê°€ ì¼ì‹œ ì¤‘ë‹¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            // ì‚¬ìš´ë“œë¥¼ ì¬ìƒí•˜ê¸° ì „ì— ì¬ê°œí•´ì•¼ í•©ë‹ˆë‹¤.
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }

            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();

            // ì—°ê²°: Oscillator -> Gain -> Destination
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            // íŒŒí˜• ì„¤ì • (sawtoothê°€ ë‚ ì¹´ë¡œìš´ ì†Œë¦¬ì— ì í•©)
            oscillator.type = 'sawtooth';

            // ì£¼íŒŒìˆ˜ ì„¤ì • (ë†’ì€ ìŒì—ì„œ ì‹œì‘)
            oscillator.frequency.setValueAtTime(880, audioCtx.currentTime); // A5

            // ë³¼ë¥¨ ì„¤ì • (ì²˜ìŒì—” ìµœëŒ€, ë¹ ë¥´ê²Œ ê°ì†Œ)
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2); // 0.2ì´ˆì— ê±¸ì³ ì†Œë¦¬ ê°ì†Œ

            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.2); // 0.2ì´ˆ í›„ ì •ì§€
        }


        const NUM_BEARDS = 40; // ìƒì„±í•  ìˆ˜ì—¼ ê°œìˆ˜
        const TIME_LIMIT = 30; // ì œí•œ ì‹œê°„ (ì´ˆ)

        let pluckCount = 0;
        let isPained = false;
        let timeLeft = TIME_LIMIT;
        let timerInterval = null;
        let isGameOver = false; // ê²Œì„ ì˜¤ë²„ ìƒíƒœ ì¶”ì 

        /**
         * ìˆ˜ì—¼ì´ ìƒì„±ë  ìˆ˜ ìˆëŠ” ì–¼êµ´ ì˜ì—­ì˜ ê²½ê³„ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
         * (ì½” ì•„ë˜, ì… ì£¼ë³€)
         * @returns {{x: number, y: number, r: number}}
         */
        function getBeardArea() {
            // ì•„ì €ì”¨ ì–¼êµ´ ì¤‘ì‹¬: x=150, y=175
            // ìˆ˜ì—¼ì€ ì½”(y=160)ì™€ ì…(y=230) ì£¼ë³€ì— ì§‘ì¤‘
            return {
                centerX: 150,
                centerY: 240,
                radiusX: 100, // ê°€ë¡œ ë²”ìœ„
                radiusY: 70   // ì„¸ë¡œ ë²”ìœ„
            };
        }

        /**
         * ì–¼êµ´ ì˜ì—­ ë‚´ì—ì„œ ëœë¤í•œ ìœ„ì¹˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.
         * @param {object} area - ìˆ˜ì—¼ ì˜ì—­ ì •ë³´
         * @returns {{left: number, top: number}}
         */
        function getRandomPosition(area) {
            let x, y, dx, dy;
            let count = 0;
            const maxTries = 100;

            do {
                // íƒ€ì› ì˜ì—­ ë‚´ì—ì„œ ëœë¤ ì¢Œí‘œ ìƒì„±
                const angle = Math.random() * 2 * Math.PI;
                const dist = Math.random();

                dx = Math.cos(angle) * area.radiusX * dist;
                dy = Math.sin(angle) * area.radiusY * dist;

                x = area.centerX + dx;
                y = area.centerY + dy;
                count++;
            } while (y < 200 || count > maxTries); // ì½”(160) ì•„ë˜, ì…(230) ì£¼ë³€ìœ¼ë¡œ ì œí•œ

            return {
                left: Math.round(x),
                top: Math.round(y)
            };
        }


        /**
         * ìˆ˜ì—¼ í„¸ ìš”ì†Œë¥¼ ìƒì„±í•˜ê³  ì–¼êµ´ì— ì¶”ê°€í•©ë‹ˆë‹¤.
         */
        function generateBeards() {
            const area = getBeardArea();

            for (let i = 0; i < NUM_BEARDS; i++) {
                const pos = getRandomPosition(area);

                const beard = document.createElement('div');
                beard.className = 'beard-hair';
                beard.style.left = `${pos.left}px`;
                beard.style.top = `${pos.top}px`;
                // íšŒì „ ê°ë„ ëœë¤ ì„¤ì • (ìˆ˜ì—¼ì´ ì‚ì­‰ì‚ì­‰í•œ ëŠë‚Œ)
                beard.style.transform = `rotate(${Math.random() * 60 - 30}deg)`;

                beard.addEventListener('click', handlePluck);
                ahjussiHead.appendChild(beard);
            }
            totalCountElement.textContent = NUM_BEARDS;
        }

        /**
         * ìˆ˜ì—¼ ë½‘ê¸° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì…ë‹ˆë‹¤.
         * @param {Event} event - í´ë¦­ ì´ë²¤íŠ¸
         */
        function handlePluck(event) {
            if (isPained || isGameOver) return; // ì´ë¯¸ ì•„íŒŒí•˜ëŠ” ì¤‘ì´ê±°ë‚˜ ê²Œì„ ì˜¤ë²„ë©´ ë¬´ì‹œ

            const pluckedHair = event.currentTarget;

            // 1. ìˆ˜ì—¼ ì œê±°
            pluckedHair.removeEventListener('click', handlePluck);
            pluckedHair.style.opacity = '0';
            pluckedHair.style.transform = 'translateY(-10px)';
            setTimeout(() => pluckedHair.remove(), 100);

            // 2. ì ìˆ˜ ì—…ë°ì´íŠ¸
            pluckCount++;
            pluckCountElement.textContent = pluckCount;

            // 3. ì•„ì €ì”¨ í‘œì • ë³€ê²½ ë° íš¨ê³¼ìŒ ì¬ìƒ
            playOuchSound();
            showPainExpression();

            // 4. ê²Œì„ ì¢…ë£Œ í™•ì¸
            if (pluckCount >= NUM_BEARDS) {
                setTimeout(() => endGame(), 500);
            }
        }

        /**
         * ì•„ì €ì”¨ í‘œì •ì„ ê³ í†µìŠ¤ëŸ¬ìš´ í‘œì •ìœ¼ë¡œ ë°”ê¾¸ê³  ì ì‹œ í›„ ì›ë˜ëŒ€ë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.
         */
        function showPainExpression() {
            isPained = true;
            ahjussiHead.classList.add('pain');

            // ë”°ë”! í…ìŠ¤íŠ¸ í‘œì‹œ
            ouchText.classList.add('show');

            // 0.5ì´ˆ í›„ í‘œì • ì›ë˜ëŒ€ë¡œ ë³µêµ¬
            setTimeout(() => {
                ahjussiHead.classList.remove('pain');
                ouchText.classList.remove('show');
                isPained = false;
            }, 500);
        }

        /**
         * ê²Œì„ ê²°ê³¼ë¥¼ í‘œì‹œí•˜ëŠ” ì»¤ìŠ¤í…€ ë©”ì‹œì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
         * @param {string} text - í‘œì‹œí•  ë©”ì‹œì§€
         * @param {string} color - ë©”ì‹œì§€ ìƒ‰ìƒ
         */
        function showMessage(text, color) {
            // ë©”ì‹œì§€ ì œê±° (ìˆë‹¤ë©´)
            const existingMessage = document.querySelector('.game-container .game-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            const message = document.createElement('div');
            message.className = 'game-message';
            message.textContent = text;
            message.style.cssText = `
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                font-size: 4rem;
                color: ${color};
                background: rgba(255, 255, 255, 0.95);
                padding: 20px;
                border-radius: 15px;
                text-align: center;
                z-index: 200;
                box-shadow: 0 0 25px ${color};
            `;
            document.querySelector('.game-container').appendChild(message);
        }


        /**
         * ê²Œì„ ì¢…ë£Œ ì²˜ë¦¬ (ìˆ˜ì—¼ ëª¨ë‘ ë½‘ì•˜ì„ ë•Œ)
         */
        function endGame() {
            if (isGameOver) return;

            clearInterval(timerInterval);
            isGameOver = true;

            showMessage("ğŸ¥³ ëª¨ë“  ìˆ˜ì—¼ í´ë¦¬ì–´! ğŸ¥³", '#ff0000');
        }

        /**
         * ê²Œì„ íƒ€ì´ë¨¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.
         */
        function startTimer() {
            // ê¸°ì¡´ íƒ€ì´ë¨¸ í´ë¦¬ì–´
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            timeLeft = TIME_LIMIT;
            timeDisplayElement.textContent = timeLeft;
            isGameOver = false;

            timerInterval = setInterval(() => {
                timeLeft--;
                timeDisplayElement.textContent = timeLeft;

                // ì‹œê°„ì´ 5ì´ˆ ì´í•˜ë¡œ ë‚¨ì•˜ì„ ë•Œ ë¹¨ê°„ìƒ‰ìœ¼ë¡œ ê¹œë¹¡ì´ê²Œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì„ íƒ ì‚¬í•­)
                if (timeLeft <= 5 && timeLeft > 0) {
                    timeDisplayElement.style.animation = 'blink 0.5s infinite alternate';
                } else {
                    timeDisplayElement.style.animation = 'none';
                }


                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timeUp();
                }
            }, 1000);
        }

        /**
         * ì‹œê°„ ì´ˆê³¼ ì‹œ ê²Œì„ ì¢…ë£Œ ì²˜ë¦¬
         */
        function timeUp() {
            if (isGameOver) return; // ì´ë¯¸ ìˆ˜ì—¼ ë‹¤ ë½‘ì•„ ëë‚¬ë‹¤ë©´ ë¬´ì‹œ

            isGameOver = true;

            // ìˆ˜ì—¼ í´ë¦­ ë°©ì§€
            const beards = document.querySelectorAll('.beard-hair');
            beards.forEach(beard => beard.removeEventListener('click', handlePluck));

            // ì•„ì €ì”¨ í‘œì • ì¤‘ë¦½ìœ¼ë¡œ
            ahjussiHead.classList.remove('pain');

            // ê²Œì„ ì˜¤ë²„ ë©”ì‹œì§€ í‘œì‹œ
            showMessage("â° ì‹œê°„ ì´ˆê³¼! ì•„ì €ì”¨ëŠ” ì•ˆì „í•©ë‹ˆë‹¤. â°", '#ff9900');
        }


        /**
         * ê²Œì„ì„ ì´ˆê¸°í™”í•˜ê³  ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.
         */
        function restartGame() {
            // ìºë¦­í„° ì™¸í˜• ëœë¤í™”
            const styles = ['default', 'style-1', 'style-2'];
            const randomStyle = styles[Math.floor(Math.random() * styles.length)];

            ahjussiHead.classList.remove('style-1', 'style-2'); // ê¸°ì¡´ ìŠ¤íƒ€ì¼ ì œê±°
            if (randomStyle !== 'default') {
                ahjussiHead.classList.add(randomStyle);
            }

            // ê¸°ì¡´ ìˆ˜ì—¼ ëª¨ë‘ ì œê±°
            const existingBeards = document.querySelectorAll('.beard-hair');
            existingBeards.forEach(beard => beard.remove());

            // ë©”ì‹œì§€ ì œê±° (ìˆë‹¤ë©´)
            const existingMessage = document.querySelector('.game-container .game-message');
            if (existingMessage) {
                existingMessage.remove();
            }

            // íƒ€ì´ë¨¸ ì¤‘ì§€ ë° ë””ìŠ¤í”Œë ˆì´ ì´ˆê¸°í™”
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            timeDisplayElement.style.animation = 'none';
            timeLeft = TIME_LIMIT;


            // ìƒíƒœ ì´ˆê¸°í™”
            pluckCount = 0;
            pluckCountElement.textContent = 0;
            isPained = false;
            isGameOver = false;
            ahjussiHead.classList.remove('pain'); // í˜¹ì‹œ ë‚¨ì•„ìˆì„ ê²½ìš° ì œê±°
            ouchText.classList.remove('show');

            // ìƒˆ ìˆ˜ì—¼ ìƒì„±
            generateBeards();

            // íƒ€ì´ë¨¸ ì‹œì‘
            startTimer();
        }

        // ê²Œì„ ì‹œì‘
        window.onload = function() {
            restartGame();
            document.getElementById('close-button').addEventListener('click', function() {
                window.close();
            });
        };
    </script>
</body>

</html>